import{r as y,o as w,f as D,D as a,j as t,N as S,$ as i,h as z,y as A,a5 as M,a0 as V}from"./index-KQr3sQf-.js";import{E as I,a as q,b as P,c as T,d as j,e as K,f as R,g as G}from"./index-B3M88loM.js";import{y as x,g as N,x as H}from"./_plugin-vue_export-helper-Cls8PYOu.js";import{F as J,A as L,U as O,c as Q,a as W,D as X}from"./databaseApi-CmhCTCoB.js";const Y={style:{position:"absolute",right:"20px"}},Z={style:{"margin-top":"30px"}},h={__name:"saveDatabase",emits:["afterSave"],setup(F,{expose:_,emit:g}){const m=y(!1),d=y(!1),p=y(0),b=g,l=y({describe:"",host:"",port:"3306",dataBaseName:"",username:"",password:"",suffix:"",prefix:""}),C=s=>{p.value=s,m.value=!0,s?(d.value=!0,k(s)):(d.value=!1,l.value.id=0)},k=async s=>{let e=await J(s);l.value=e.data},B=async()=>{let s=await L(l.value);x.success(s.message),l.value={},m.value=!1,b("afterSave")},U=async()=>{let s=await O(p.value,l.value);x.success(s.message),l.value={},m.value=!1,b("afterSave")},r=()=>{m.value=!1},o=()=>{l.value={}},E=async()=>{let s=await Q(l.value);x.success(s.message)};return _({open:C}),(s,e)=>{const v=I,f=q,n=P,c=N,$=T;return w(),D("div",null,[a($,{title:d.value?"修改":"新增",modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=u=>m.value=u)},{footer:t(()=>[S("div",Z,[a(c,{onClick:r},{default:t(()=>e[9]||(e[9]=[i("取消")])),_:1}),a(c,{onClick:o},{default:t(()=>e[10]||(e[10]=[i("清空")])),_:1}),d.value?(w(),z(c,{key:0,type:"primary",onClick:U},{default:t(()=>e[11]||(e[11]=[i("修改")])),_:1})):(w(),z(c,{key:1,type:"primary",onClick:B},{default:t(()=>e[12]||(e[12]=[i("新增")])),_:1}))])]),default:t(()=>[a(n,{"label-position":"left","label-width":"auto"},{default:t(()=>[a(f,{label:"描述:"},{default:t(()=>[a(v,{clearable:"",modelValue:l.value.describe,"onUpdate:modelValue":e[0]||(e[0]=u=>l.value.describe=u)},null,8,["modelValue"])]),_:1}),a(f,{label:"host:"},{default:t(()=>[a(v,{clearable:"",modelValue:l.value.host,"onUpdate:modelValue":e[1]||(e[1]=u=>l.value.host=u)},null,8,["modelValue"])]),_:1}),a(f,{label:"port:"},{default:t(()=>[a(v,{clearable:"",placeholder:"3306",modelValue:l.value.port,"onUpdate:modelValue":e[2]||(e[2]=u=>l.value.port=u)},null,8,["modelValue"])]),_:1}),a(f,{label:"dataBaseName:"},{default:t(()=>[a(v,{clearable:"",modelValue:l.value.dataBaseName,"onUpdate:modelValue":e[3]||(e[3]=u=>l.value.dataBaseName=u)},null,8,["modelValue"])]),_:1}),a(f,{label:"username:"},{default:t(()=>[a(v,{clearable:"",modelValue:l.value.username,"onUpdate:modelValue":e[4]||(e[4]=u=>l.value.username=u)},null,8,["modelValue"])]),_:1}),a(f,{label:"password:"},{default:t(()=>[a(v,{clearable:"",type:"password",modelValue:l.value.password,"onUpdate:modelValue":e[5]||(e[5]=u=>l.value.password=u)},null,8,["modelValue"])]),_:1}),a(f,{label:"数据库前缀是什么:"},{default:t(()=>[a(v,{clearable:"",type:"text",placeholder:"比如my_product,前缀就是my_,后面可能要用到'去除指定前缀'",modelValue:l.value.prefix,"onUpdate:modelValue":e[6]||(e[6]=u=>l.value.prefix=u)},null,8,["modelValue"])]),_:1})]),_:1}),S("div",Y,[a(c,{onClick:E,type:"warning"},{default:t(()=>e[8]||(e[8]=[i("测试连接")])),_:1})])]),_:1},8,["title","modelValue"])])}}},ee={style:{"margin-top":"20px"}},ae={__name:"databaseManager",setup(F){const _=y(null),g=y([]),m=y(0),d=async()=>{let r=await W(p.value);g.value=r.data.data,m.value=r.data.total};A(()=>{d()});const p=y({page:1,size:5,queryStr:""}),b=()=>{_.value.open(0)},l=r=>{_.value.open(r)},C=async r=>{R.confirm("确定删除该配置吗？","提示",{type:"warning"}).then(async()=>{let o=await X(r);x.success(o.message),await d()}).catch(()=>{console.log("取消删除")})},k=()=>{d()},B=r=>{p.value.size=r,d()},U=r=>{p.value.page=r,d()};return(r,o)=>{const E=I,s=N,e=G,v=j,f=K;return w(),D("div",null,[S("div",ee,[a(E,{style:{width:"250px"},modelValue:p.value.queryStr,"onUpdate:modelValue":o[0]||(o[0]=n=>p.value.queryStr=n),clearable:"",onClear:d,onKeyup:M(d,["enter"]),placeholder:"可根据数据库名,host等搜索"},null,8,["modelValue"]),a(s,{style:{"margin-left":"20px"},type:"primary",onClick:d},{default:t(()=>o[3]||(o[3]=[i("查询")])),_:1}),a(s,{style:{"margin-left":"20px"},type:"primary",onClick:b},{default:t(()=>o[4]||(o[4]=[i("新增数据源")])),_:1})]),a(v,{style:{"margin-top":"10px"},data:g.value},{default:t(()=>[a(e,{label:"描述"},{default:t(n=>[i(V(n.row.describe),1)]),_:1}),a(e,{label:"host"},{default:t(n=>[i(V(n.row.host)+":"+V(n.row.port),1)]),_:1}),a(e,{label:"数据库名"},{default:t(n=>[i(V(n.row.dataBaseName),1)]),_:1}),a(e,{label:"操作"},{default:t(n=>[a(s,{type:"primary",onClick:c=>l(n.row.id)},{default:t(()=>o[5]||(o[5]=[i("修改")])),_:2},1032,["onClick"]),a(s,{type:"danger",onClick:c=>C(n.row.id)},{default:t(()=>o[6]||(o[6]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(f,{"current-page":p.value.page,"onUpdate:currentPage":o[1]||(o[1]=n=>p.value.page=n),"page-size":p.value.size,"onUpdate:pageSize":o[2]||(o[2]=n=>p.value.size=n),"page-sizes":[1,5,10],layout:"total, sizes, prev, pager, next, jumper",total:m.value,onSizeChange:B,onCurrentChange:U},null,8,["current-page","page-size","total"]),a(h,{ref_key:"saveDatabaseRef",ref:_,onAfterSave:k},null,512)])}}},ne=H(ae,[["__scopeId","data-v-cdead86e"]]);export{ne as default};
